(()=>{"use strict";var e={470:(e,t,s)=>{s.d(t,{$:()=>r,T:()=>n});const r=["lu5_getCursorPos","lu5_init_freetype","lu5_close_fonts","lu5_render_text","lu5_load_default_font","lu5_load_and_add_font","lu5_set_font","lu5_time_seed","lu5_createWindow","lu5_image_crop","lu5_load_image","lu5_render_image","lu5_apply_color","lu5_background","lu5_glBegin","lu5_glVertex2","lu5_glEnd","lu5_render_ellipse","lu5_render_ring","lu5_render_arc_fill","lu5_render_arc_stroke","lu5_render_quad_fill","lu5_render_quad_stroke","lu5_render_debug","lu5_render_box_faces","lu5_render_box_edges","lu5_render_cylinder_faces","lu5_render_cylinder_edges","lu5_render_torus_faces","lu5_render_torus_edges","lu5_render_plane_faces","lu5_render_plane_edges","lu5_render_sphere_faces","lu5_render_sphere_edges"],n=["args_get","args_sizes_get","environ_get","environ_sizes_get","clock_res_get","clock_time_get","fd_close","fd_prestat_get","fd_prestat_dir_name","fd_write","fd_read","fd_seek","proc_exit","path_open","path_unlink_file","path_filestat_get","path_filestat_set_times","path_symlink","path_link","path_remove_directory","poll_oneoff","proc_raise","sched_yield","sock_send","sock_recv","sock_shutdown","sock_close","fd_fdstat_get","fd_fdstat_set_flags","fd_sync","fd_allocate","fd_advise","path_rename","path_open","fd_filestat_get","fd_filestat_set_times","fd_filestat_set_size","fd_filestat_set_times","fd_renumber","fd_datasync","fd_pread","fd_pwrite","fd_readdir","fd_fdstat_set_rights","fd_tell","path_create_directory","path_readlink","path_filestat_set_size","sock_accept","sock_bind","sock_connect","sock_listen","sock_recvmsg","sock_sendmsg","sock_create","sock_shutdown","sock_recv","sock_send"]},490:(e,t,s)=>{s.d(t,{Jt:()=>l,bp:()=>i,dk:()=>n,fe:()=>r,xs:()=>o});const r=0,n=1,i=2,o=e=>+e.metaKey<<8|+e.ctrlKey<<2,l={8:259,9:258,13:257,16:340,17:341,18:342,19:284,20:280,27:256,32:32,33:266,34:267,35:269,36:268,37:263,38:265,39:262,40:264,45:260,46:261,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:343,92:344,93:348,96:320,97:321,98:322,99:323,100:324,101:325,102:326,103:327,104:328,105:329,106:332,107:334,109:333,110:330,111:331,112:290,113:291,114:292,115:293,116:294,117:295,118:296,119:297,120:298,121:299,122:300,123:301,144:282,145:281,186:59,187:61,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39}},156:(e,t,s)=>{var r=s(434);window.onload=async()=>function(e){const t=new r.b;return window.lu5=t,t.instantiate(e).then((e=>t.get_script())).then((e=>t.vm(e))).catch(console.error)}("../../bin/wasm/lu5.wasm")},434:(e,t,s)=>{s.d(t,{b:()=>o});var r=s(470),n=s(82),i=s(634);class o{constructor(){this.l5=null,this.wasm=null,this.ctx=null,this.gl=null,this.memory=null,this.view=null,this.lastTime=0,this.mouseX=0,this.mouseY=0,this.loop=!0,this.depth_mode=0,this.env={getTempRet0:()=>0,saveSetjmp:e=>0,testSetjmp:(e,t)=>0}}static makeEnv(e,t,s){const r={};for(let n of t)r[n]=null!=s[n]?s[n].bind(e):()=>0;return r}get_cstr(e,t){if(!this.memory)return"";if(void 0!==t){let s=new Uint8Array(this.memory.buffer,e,t);return(new TextDecoder).decode(s)}let s=new Uint8Array(this.memory.buffer,e,this.memory.buffer.byteLength-e);return(new TextDecoder).decode(s.subarray(0,s.indexOf(0)))}write_cstr(e,t){if(!this.memory)return;let s=(new TextEncoder).encode(t),r=new Uint8Array(this.memory.buffer);e+t.length>=this.memory.buffer.byteLength?console.error("Memory overflow"):r.set(s,e)}static bytesToNumber(e){let t=0;for(let s of e.reverse())t=256*t+s;return t}deref(e,t){return this.memory?new Uint8Array(this.memory.buffer,e,t):new Uint8Array(0)}colorToRGBA(e){if(this.refreshMemory(),!this.view)return"#000";const t=this.view.getUint8(e);return 0==t?"#000":"#"+this.view.getUint8(e+3).toString(16).padStart(2)+this.view.getUint8(e+2).toString(16).padStart(2)+this.view.getUint8(e+1).toString(16).padStart(2)+t.toString(16).padStart(2)}refreshMemory(){this.memory&&(null!==this.view&&0!==this.view.buffer.byteLength||(this.view=new DataView(this.memory.buffer)))}setMemory(e){this.memory=e}static async get_script_source(e){let t=e.getAttribute("src");return t?fetch(t).then((e=>e.text())):e.textContent}static get_scripts(){const e=document.querySelectorAll('script[type="text/lua"]');return Array.from(e).map((e=>({src:e.getAttribute("src"),canvas:e.getAttribute("canvas"),content:o.get_script_source(e)})))}async get_script(){const e=o.get_scripts(),t=await e[0].content;return t?new Promise((e=>e(t))):""}instantiate(e){return WebAssembly.instantiateStreaming(fetch(e),{env:{...o.makeEnv(this,r.$,i),...this.env},wasi_snapshot_preview1:o.makeEnv(this,r.T,n)}).then((e=>(this.wasm=e,this.setMemory(e.instance.exports.memory),e)))}vm(e){if(null===this.wasm||!this.wasm.instance)return void console.warn("lu5 wasm hasn't loaded yet.");const t=this.wasm.instance.exports.malloc,s=this.wasm.instance.exports._lu5_get_handle,r=this.wasm.instance.exports._lu5_setup,n=this.wasm.instance.exports._lu5_animation_frame;Object.defineProperty(this,"l5",{writable:!1,value:s()});const i=t(e.length);if(this.write_cstr(i,e),this.l5)if(0===r(this.l5,null,i)){let e=0;const t=(s=>{const r=(s-e)/1e3;n(this.l5,r),e=s,this.loop&&requestAnimationFrame(t)}).bind(this);requestAnimationFrame(t)}else this.reset()}reset(){if(!this.wasm)return;const e=this.wasm.instance.exports._lu5_close;this.l5&&e(this.l5),this.ctx&&this.ctx.canvas.remove()}}},677:(e,t,s)=>{s.d(t,{$m:()=>l,EZ:()=>h,Hm:()=>_,Hz:()=>f,M7:()=>m,ME:()=>n,Wr:()=>c,hY:()=>a,k8:()=>o,pX:()=>u,uL:()=>d,ww:()=>i});var r=s(490);function n(e,t,s,n,i){if(!this.wasm)return 0;this.depth_mode=i;const o=this.wasm.instance.exports._lu5_mouse_scroll_callback,l=this.wasm.instance.exports._lu5_key_callback,c=this.wasm.instance.exports._lu5_mouse_cursor_callback,_=this.wasm.instance.exports._lu5_mouse_button_callback,a=this.get_cstr(n);let u=Array.from(document.querySelectorAll("canvas")).filter((e=>e.getAttribute("id")===a))[0];switch(u||(u=document.createElement("canvas")),u.width=t,u.height=s,document.addEventListener("wheel",(e=>o(null,e.deltaX>0?1:-1,e.deltaY>0?1:-1))),document.addEventListener("keydown",(e=>{l(null,r.Jt[e.keyCode]||0,e.key,e.repeat?r.bp:r.dk,(0,r.xs)(e))})),document.addEventListener("keyup",(e=>{l(null,r.Jt[e.keyCode]||0,e.key,r.fe,(0,r.xs)(e))})),u.addEventListener("mousemove",(e=>{const t=u.getBoundingClientRect();this.mouseX=e.clientX-t.left,this.mouseY=e.clientY-t.top,c(null,this.mouseX,this.mouseY)})),u.addEventListener("mousedown",(e=>_(null,e.button,1,0))),u.addEventListener("mouseup",(e=>_(null,e.button,0,0))),i){case 0:this.ctx=u.getContext("2d");break;case 1:this.gl=u.getContext("webgl")}return document.body.appendChild(u),0}function i(e){switch(this.depth_mode){case 0:if(!this.ctx)break;this.ctx.fillStyle=this.colorToRGBA(e),this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.fill();break;case 1:if(!this.gl)break;this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT)}}function o(e){this.ctx&&this.ctx.beginPath()}function l(e,t){this.ctx&&(this.ctx.moveTo(e,t),this.ctx.lineTo(e,t))}function c(){this.ctx&&this.ctx.closePath()}function _(e,t,s,r,n,i){this.ctx&&(this.ctx.fillStyle=this.colorToRGBA(i),this.ctx.beginPath(),this.ctx.ellipse(e,t,s,r,0,0,2*Math.PI),this.ctx.fill())}function a(e,t,s,r,n,i,o){this.ctx&&(this.ctx.strokeStyle=this.colorToRGBA(o),this.ctx.beginPath(),this.ctx.ellipse(e,t,r,s,0,0,2*Math.PI),this.ctx.lineWidth=n,this.ctx.stroke())}function u(e,t,s,r,n,i,o,l){this.ctx&&(this.ctx.fillStyle=this.colorToRGBA(l),this.ctx.beginPath(),this.ctx.ellipse(e,t,s,r,0,n,i),this.ctx.lineTo(e,t),this.ctx.closePath(),this.ctx.fill())}function d(e,t,s,r,n,i,o,l,c){this.ctx&&(this.ctx.strokeStyle=this.colorToRGBA(c),this.ctx.beginPath(),this.ctx.ellipse(e,t,s,r,0,i,o),this.ctx.lineWidth=n,this.ctx.stroke())}function h(e,t,s,r,n,i,o,l,c){this.ctx&&(this.ctx.fillStyle=this.colorToRGBA(c),this.ctx.beginPath(),this.ctx.moveTo(e,t),this.ctx.lineTo(s,r),this.ctx.lineTo(n,i),this.ctx.lineTo(o,l),this.ctx.closePath(),this.ctx.fill())}function f(e,t,s,r,n,i,o,l,c,_){if(!this.ctx)return;this.ctx.strokeStyle=this.colorToRGBA(_);const a=Math.min(e,s,n,o),u=Math.min(t,r,i,l),d=Math.max(e,s,n,o)-a,h=Math.max(t,r,i,l)-u;this.ctx.lineWidth=c,this.ctx.strokeRect(a,u,d,h)}function m(e,t,s,r,n,i,o){if(!this.ctx)return;const l=this.get_cstr(e);switch(n){case 1:this.ctx.textAlign="center";break;case 2:this.ctx.textAlign="right";break;case 3:this.ctx.textAlign="left"}this.ctx.font=`${r}px Arial`,this.ctx.fillStyle=this.colorToRGBA(o),this.ctx.fillText(l,t,s)}},148:(e,t,s)=>{function r(){console.log("lu5_render_debug")}function n(e,t,s,r,n,i){console.log("lu5_render_box_faces",e,t,s,r,n,i)}function i(e,t,s,r,n,i){console.log("lu5_render_box_edges",e,t,s,r,n,i)}function o(e,t,s,r,n){console.log("lu5_render_cylinder_faces",e,t,s,r,n)}function l(e,t,s,r,n){console.log("lu5_render_cylinder_edges",e,t,s,r,n)}function c(e,t,s,r,n){console.log("lu5_render_torus_faces",e,t,s,r,n)}function _(e,t,s,r,n){console.log("lu5_render_torus_edges",e,t,s,r,n)}function a(e,t,s,r,n){console.log("lu5_render_plane_faces",e,t,s,r,n)}function u(e,t,s,r,n){console.log("lu5_render_plane_edges",e,t,s,r,n)}function d(e,t,s,r){console.log("lu5_render_sphere_faces",e,t,s,r)}function h(e,t,s,r){console.log("lu5_render_sphere_edges",e,t,s,r)}s.d(t,{GV:()=>a,Nb:()=>d,PB:()=>c,Qx:()=>o,hS:()=>n,q2:()=>l,r9:()=>i,uV:()=>u,vr:()=>_,wg:()=>r,z8:()=>h})},634:(e,t,s)=>{s.r(t),s.d(t,{lu5_background:()=>r.ww,lu5_close_fonts:()=>l,lu5_createWindow:()=>r.ME,lu5_getCursorPos:()=>i,lu5_glBegin:()=>r.k8,lu5_glEnd:()=>r.Wr,lu5_glVertex:()=>r.$m,lu5_init_freetype:()=>o,lu5_load_and_add_font:()=>c,lu5_load_default_font:()=>a,lu5_render_arc_fill:()=>r.pX,lu5_render_arc_stroke:()=>r.uL,lu5_render_box_edges:()=>n.r9,lu5_render_box_faces:()=>n.hS,lu5_render_cylinder_edges:()=>n.q2,lu5_render_cylinder_faces:()=>n.Qx,lu5_render_debug:()=>n.wg,lu5_render_ellipse:()=>r.Hm,lu5_render_plane_edges:()=>n.uV,lu5_render_plane_faces:()=>n.GV,lu5_render_quad_fill:()=>r.EZ,lu5_render_quad_stroke:()=>r.Hz,lu5_render_ring:()=>r.hY,lu5_render_sphere_edges:()=>n.z8,lu5_render_sphere_faces:()=>n.Nb,lu5_render_text:()=>r.M7,lu5_render_torus_edges:()=>n.vr,lu5_render_torus_faces:()=>n.PB,lu5_set_font:()=>_,lu5_time_seed:()=>u});var r=s(677),n=s(148);function i(e,t,s){return this.refreshMemory(),this.view&&(this.view.setFloat64(t,this.mouseX,!0),this.view.setFloat64(s,this.mouseY,!0)),0}function o(){return 0}function l(){return 0}function c(e,t,s){console.warn("'lu5_load_and_add_font' is not yet implemented...")}function _(e){const t=this.get_cstr(e);return console.warn(`Trying to set font ${t} but 'lu5_set_font' is not yet implemented...`),0}function a(){return 0}function u(){return Math.floor(1e6*Math.random())}},613:()=>{},82:(e,t,s)=>{s.r(t),s.d(t,{clock_res_get:()=>i,clock_time_get:()=>o,fd_write:()=>n});var r=s(434);function n(e,t,s,n){if(!this.memory)return;const i=this.memory.buffer;let o=0;const l=[];for(let e=0;e<s;e++){const s=t+8*e;if(s<0||s+8>i.byteLength){console.error(`fd_write: iovec_ptr (${s}) out of bounds at iovec index ${e}`);continue}const n=r.b.bytesToNumber(this.deref(s,4)),c=r.b.bytesToNumber(this.deref(s+4,4));if(n<0||n+c>i.byteLength){console.error(`fd_write: Data pointer (${n}) out of bounds or invalid size at iovec index ${e}`);continue}if(c<=0)continue;const _=this.deref(n,c);l.push(_),o+=c}let c=new Uint8Array(o),_=0;l.forEach((e=>{c.set(e,_),_+=e.length}));let a=(new TextDecoder).decode(c);switch(e){case 1:console.log(a);break;case 2:console.error(a);break;default:return console.error("fd_write: unknown file descriptor"),1}let u=o;return this.view&&this.view.setUint32(n,u,!0),u}function i(e,t){return this.view&&this.view.setBigUint64(t,1000n,!0),0}function o(e,t,s){return this.view&&this.view.setBigUint64(s,1000000n*BigInt(Date.now()),!0),0}}},t={};function s(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,s),i.exports}s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s(613),s(470),s(490),s(434),s(82),s(677),s(148),s(634);s(156)})();
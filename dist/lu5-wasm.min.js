(()=>{"use strict";var t={d:(e,i)=>{for(var n in i)t.o(i,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:i[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{clock_res_get:()=>o,clock_time_get:()=>l,fd_write:()=>r});var i={};t.r(i),t.d(i,{lu5_background:()=>m,lu5_close_fonts:()=>W,lu5_createWindow:()=>f,lu5_getCursorPos:()=>D,lu5_glBegin:()=>g,lu5_glEnd:()=>w,lu5_glVertex:()=>p,lu5_init_freetype:()=>F,lu5_load_and_add_font:()=>X,lu5_load_default_font:()=>$,lu5_loop:()=>q,lu5_noLoop:()=>G,lu5_render_arc_fill:()=>b,lu5_render_arc_stroke:()=>v,lu5_render_box_edges:()=>U,lu5_render_box_faces:()=>P,lu5_render_cylinder_edges:()=>E,lu5_render_cylinder_faces:()=>B,lu5_render_debug:()=>T,lu5_render_ellipse:()=>x,lu5_render_plane_edges:()=>C,lu5_render_plane_faces:()=>L,lu5_render_quad_fill:()=>k,lu5_render_quad_stroke:()=>A,lu5_render_ring:()=>y,lu5_render_sphere_edges:()=>O,lu5_render_sphere_faces:()=>j,lu5_render_text:()=>S,lu5_render_torus_edges:()=>R,lu5_render_torus_faces:()=>M,lu5_set_font:()=>Y,lu5_time_seed:()=>z});const n=["lu5_image_crop","lu5_load_image","lu5_render_image","lu5_apply_color","lu5_glVertex2"],s=["args_get","args_sizes_get","environ_get","environ_sizes_get","fd_close","fd_prestat_get","fd_prestat_dir_name","fd_read","fd_seek","proc_exit","path_open","path_unlink_file","path_filestat_get","path_filestat_set_times","path_symlink","path_link","path_remove_directory","poll_oneoff","proc_raise","sched_yield","sock_send","sock_recv","sock_shutdown","sock_close","fd_fdstat_get","fd_fdstat_set_flags","fd_sync","fd_allocate","fd_advise","path_rename","path_open","fd_filestat_get","fd_filestat_set_times","fd_filestat_set_size","fd_filestat_set_times","fd_renumber","fd_datasync","fd_pread","fd_pwrite","fd_readdir","fd_fdstat_set_rights","fd_tell","path_create_directory","path_readlink","path_filestat_set_size","sock_accept","sock_bind","sock_connect","sock_listen","sock_recvmsg","sock_sendmsg","sock_create","sock_shutdown","sock_recv","sock_send"];function r(t,e,i,n){if(!this.memory)return;this.refreshMemory();const s=this.memory.buffer;let r=0;const o=[];for(let t=0;t<i;t++){const i=e+8*t;if(i<0||i+8>s.byteLength){console.error(`fd_write: iovec_ptr (${i}) out of bounds at iovec index ${t}`);continue}const n=this.view.getUint32(i,!0),l=this.view.getUint32(i+4,!0);if(n<0||n+l>s.byteLength){console.error(`fd_write: Data pointer (${n}) out of bounds or invalid size at iovec index ${t}`);continue}if(l<=0)continue;const c=new Uint8Array(this.memory.buffer,n,l);o.push(c),r+=l}let l=new Uint8Array(r),c=0;o.forEach((t=>{l.set(t,c),c+=t.length}));let a=(new TextDecoder).decode(l);switch(t){case 1:console.log(a);break;case 2:console.error(a);break;default:return console.error("fd_write: unknown file descriptor"),1}let u=r;return this.view&&this.view.setUint32(n,u,!0),u}function o(t,e){return this.view&&this.view.setBigUint64(e,1000n,!0),0}function l(t,e,i){return this.view&&this.view.setBigUint64(i,1000000n*BigInt(Date.now()),!0),0}function c(t,e,i){if(!t)return"";if(void 0!==i){let n=new Uint8Array(t.buffer,e,i);return(new TextDecoder).decode(n)}let n=new Uint8Array(t.buffer,e,t.buffer.byteLength-e);return(new TextDecoder).decode(n.subarray(0,n.indexOf(0)))}const a=0,u=1,h=2,_=t=>+t.metaKey<<8|+t.ctrlKey<<2,d={8:259,9:258,13:257,16:340,17:341,18:342,19:284,20:280,27:256,32:32,33:266,34:267,35:269,36:268,37:263,38:265,39:262,40:264,45:260,46:261,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:343,92:344,93:348,96:320,97:321,98:322,99:323,100:324,101:325,102:326,103:327,104:328,105:329,106:332,107:334,109:333,110:330,111:331,112:290,113:291,114:292,115:293,116:294,117:295,118:296,119:297,120:298,121:299,122:300,123:301,144:282,145:281,186:59,187:61,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39};function f(t,e,i,n,s){if(!this.wasm)return 0;this.depth_mode=s;const r=this.wasm.instance.exports._lu5_mouse_scroll_callback,o=this.wasm.instance.exports._lu5_key_callback,l=this.wasm.instance.exports._lu5_mouse_cursor_callback,c=this.wasm.instance.exports._lu5_mouse_button_callback;let f=Array.from(document.querySelectorAll("canvas")).filter((t=>t.getAttribute("id")===this.canvas_id))[0];switch(f||(f=document.createElement("canvas"),document.body.appendChild(f)),this.canvas_id&&f.setAttribute("id",this.canvas_id),f.width=e,f.height=i,document.addEventListener("wheel",(t=>r(null,t.deltaX>0?1:-1,t.deltaY>0?1:-1))),document.addEventListener("keydown",(t=>{o(null,d[t.keyCode]||0,t.key,t.repeat?h:u,_(t))})),document.addEventListener("keyup",(t=>{o(null,d[t.keyCode]||0,t.key,a,_(t))})),f.addEventListener("mousemove",(t=>{const e=f.getBoundingClientRect();this.mouseX=t.clientX-e.left,this.mouseY=t.clientY-e.top,l(null,this.mouseX,this.mouseY)})),f.addEventListener("mousedown",(t=>c(null,t.button,1,0))),f.addEventListener("mouseup",(t=>c(null,t.button,0,0))),s){case 0:this.ctx=f.getContext("2d");break;case 1:this.gl=f.getContext("webgl")}return 0}function m(t){switch(this.depth_mode){case 0:if(!this.ctx)break;this.ctx.fillStyle=this.colorToRGBA(t),this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.fill();break;case 1:if(!this.gl)break;this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT)}}function g(t){this.ctx&&this.ctx.beginPath()}function p(t,e){this.ctx&&(this.ctx.moveTo(t,e),this.ctx.lineTo(t,e))}function w(){this.ctx&&this.ctx.closePath()}function x(t,e,i,n,s,r){this.ctx&&(this.ctx.fillStyle=this.colorToRGBA(r),this.ctx.beginPath(),this.ctx.ellipse(t,e,i,n,0,0,2*Math.PI),this.ctx.fill())}function y(t,e,i,n,s,r,o){this.ctx&&(this.ctx.strokeStyle=this.colorToRGBA(o),this.ctx.beginPath(),this.ctx.ellipse(t,e,n,i,0,0,2*Math.PI),this.ctx.lineWidth=s,this.ctx.stroke())}function b(t,e,i,n,s,r,o,l){this.ctx&&(this.ctx.fillStyle=this.colorToRGBA(l),this.ctx.beginPath(),this.ctx.ellipse(t,e,i,n,0,s,r),this.ctx.lineTo(t,e),this.ctx.closePath(),this.ctx.fill())}function v(t,e,i,n,s,r,o,l,c){this.ctx&&(this.ctx.strokeStyle=this.colorToRGBA(c),this.ctx.beginPath(),this.ctx.ellipse(t,e,i,n,0,r,o),this.ctx.lineWidth=s,this.ctx.stroke())}function k(t,e,i,n,s,r,o,l,c){this.ctx&&(this.ctx.fillStyle=this.colorToRGBA(c),this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(i,n),this.ctx.lineTo(s,r),this.ctx.lineTo(o,l),this.ctx.closePath(),this.ctx.fill())}function A(t,e,i,n,s,r,o,l,c,a){if(!this.ctx)return;this.ctx.strokeStyle=this.colorToRGBA(a);const u=Math.min(t,i,s,o),h=Math.min(e,n,r,l),_=Math.max(t,i,s,o)-u,d=Math.max(e,n,r,l)-h;this.ctx.lineWidth=c,this.ctx.strokeRect(u,h,_,d)}function S(t,e,i,n,s,r,o){if(!this.ctx)return;const l=c(this.memory,t);switch(s){case 1:this.ctx.textAlign="center";break;case 2:this.ctx.textAlign="right";break;case 3:this.ctx.textAlign="left"}this.ctx.font=`${n}px Arial`,this.ctx.fillStyle=this.colorToRGBA(o),this.ctx.fillText(l,e,i)}function T(){console.log("lu5_render_debug")}function P(t,e,i,n,s,r){console.log("lu5_render_box_faces",t,e,i,n,s,r)}function U(t,e,i,n,s,r){console.log("lu5_render_box_edges",t,e,i,n,s,r)}function B(t,e,i,n,s){console.log("lu5_render_cylinder_faces",t,e,i,n,s)}function E(t,e,i,n,s){console.log("lu5_render_cylinder_edges",t,e,i,n,s)}function M(t,e,i,n,s){console.log("lu5_render_torus_faces",t,e,i,n,s)}function R(t,e,i,n,s){console.log("lu5_render_torus_edges",t,e,i,n,s)}function L(t,e,i,n,s){console.log("lu5_render_plane_faces",t,e,i,n,s)}function C(t,e,i,n,s){console.log("lu5_render_plane_edges",t,e,i,n,s)}function j(t,e,i,n){console.log("lu5_render_sphere_faces",t,e,i,n)}function O(t,e,i,n){console.log("lu5_render_sphere_edges",t,e,i,n)}function G(){this.loop=!1}function q(){this.loop||requestAnimationFrame(this.frame),this.loop=!0}function D(t,e,i){return this.refreshMemory(),this.view&&(this.view.setFloat64(e,this.mouseX,!0),this.view.setFloat64(i,this.mouseY,!0)),0}function F(){return 0}function W(){return 0}function X(t,e,i){console.warn("'lu5_load_and_add_font' is not yet implemented...")}function Y(t){const e=c(this.memory,t);return console.warn(`Trying to set font ${e} but 'lu5_set_font' is not yet implemented...`),0}function $(){return 0}function z(){return Math.floor(1e6*Math.random())}function I(t){if(this.refreshMemory(),!this.view)return"#000";const e=this.view.getUint8(t);if(0==e)return"#000";return"#"+this.view.getUint8(t+3).toString(16).padStart(2,"0")+this.view.getUint8(t+2).toString(16).padStart(2,"0")+this.view.getUint8(t+1).toString(16).padStart(2,"0")+e.toString(16).padStart(2,"0")}var V,K,N=function(t,e,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)};class H{constructor(){V.add(this),this.colorToRGBA=I.bind(this),this.canvas_id=null,this.l5=null,this.wasm=null,this.ctx=null,this.gl=null,this.memory=null,this.view=null,this.lastTime=0,this.mouseX=0,this.mouseY=0,this.loop=!0,this.frame=void 0,this.depth_mode=0,this.env={getTempRet0:()=>0,saveSetjmp:t=>0,testSetjmp:(t,e)=>0}}refreshMemory(){this.memory&&(null!==this.view&&0!==this.view.buffer.byteLength||(this.view=new DataView(this.memory.buffer)))}static makeEnv(t,e,i){const n={},s=[...new Set([...e,...Object.keys(i)])];for(let e of s)n[e]=null==i[e]?()=>0:i[e].bind(t);return n}instantiate(t){return WebAssembly.instantiateStreaming(fetch(t),{env:{...H.makeEnv(this,n,i),...this.env},wasi_snapshot_preview1:H.makeEnv(this,s,e)}).then((t=>(this.wasm=t,this.memory=t.instance.exports.memory,this)))}execute(t){return new Promise((e=>{N(this,V,"m",K).call(this,t,(()=>e(this)))}))}reset(){if(!this.wasm)return this;const t=this.wasm.instance.exports._lu5_close;return this.l5&&(t(this.l5),Object.defineProperty(this,"l5",{value:null,writable:!1})),this.ctx&&this.ctx.canvas.remove(),this}}async function J(t){let e=t.getAttribute("src");return e?fetch(e).then((t=>t.text())):t.textContent}function Q(t){return t.hasAttribute("canvas")?t.getAttribute("canvas"):t.hasAttribute("src")?t.getAttribute("src").split("/").join("").split(".").filter((t=>0!=t.length)).pop():""}V=new WeakSet,K=function(t,e=()=>{}){if(null===this.wasm||!this.wasm.instance)return void console.warn("lu5 wasm hasn't loaded yet.");const i=this.wasm.instance.exports.malloc,n=this.wasm.instance.exports.free,s=this.wasm.instance.exports._lu5_get_handle,r=this.wasm.instance.exports._lu5_init,o=this.wasm.instance.exports._lu5_setup,l=this.wasm.instance.exports._lu5_animation_frame;this.l5||(Object.defineProperty(this,"l5",{writable:!1,value:s()}),r(this.l5));const c=i(t.length);if(function(t,e,i){if(!t)return;let n=(new TextEncoder).encode(i),s=new Uint8Array(n.length+1);s.set(n),s[n.length]=0;let r=new Uint8Array(t.buffer);e+s.length>=t.buffer.byteLength?console.error("Memory overflow"):r.set(s,e)}(this.memory,c,t),this.l5){if(0!==o(this.l5,null,c))return n(c),void e();{let t=0;this.frame=(e=>{const i=(e-t)/1e3;l(this.l5,i),t=e,this.loop&&requestAnimationFrame(this.frame)}).bind(this),requestAnimationFrame(this.frame)}}else n(c)},Object.defineProperty(window,"_lu5_instantiate_script",{value:document.currentScript,writable:!1,configurable:!1}),document.currentScript.hasAttribute("lib")?window.lu5={init:t=>(new H).instantiate(t)}:window.onload=()=>function(t="LU5_WASM_CDN"){if(!window._lu5_instantiate_script)return void console.error("Could not find current lu5 script");window._lu5_instantiate_script.hasAttribute("wasm")&&(t=window._lu5_instantiate_script.getAttribute("wasm"));const e=new H;e.instantiate(t).then((t=>async function(){const t=document.querySelectorAll('script[type="text/lua"]')[0];return null==t?(console.warn("No lua scripts found..."),{id:"",source:""}):{id:Q(t),source:await J(t)}}())).then((({id:t,source:i})=>{e.canvas_id=t,e.execute(i)})).catch(console.error)}()})();